<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>S-004 ãƒ†ã‚¹ãƒˆä¸€è¦§ & å—é¨“ï¼ˆãƒ‰ãƒƒã‚­ãƒ³ã‚°ç‰ˆï¼‰</title>
<style>
:root{--b:#e5e7eb;--t:#111827;--m:#6b7280;--bg:#fafafa;--card:#fff;--accent:#111827}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP",sans-serif;background:var(--bg);color:var(--t);margin:0}

.layout{display:grid;grid-template-columns:260px 1fr;gap:20px;max-width:1200px;margin:0 auto;padding:24px}
@media (max-width:960px){.layout{grid-template-columns:1fr}}

.sidenav{background:var(--card);border:1px solid var(--b);border-radius:12px;padding:16px;position:sticky;top:16px;height:max-content}
.sidenav h3{margin:0 0 10px;font-size:1rem}
.sidenav a{display:flex;align-items:center;gap:8px;text-decoration:none;color:var(--t);padding:10px 12px;border-radius:10px;margin:2px 0}
.sidenav a:hover{background:#f3f4f6}
.sidenav a.active{background:var(--accent);color:#fff}

.container{max-width:900px;margin:0 auto}
.card{background:var(--card);border:1px solid var(--b);border-radius:12px;padding:18px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
.muted{color:var(--m)}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between}
.badge{display:inline-block;background:#16a34a;color:#fff;border-radius:999px;padding:2px 10px;font-weight:700;font-size:.85rem}
.badge.warn{background:#f59e0b}
.badge.danger{background:#dc2626}
.btn{display:inline-flex;gap:8px;align-items:center;background:var(--accent);color:#fff;border:0;border-radius:999px;padding:10px 16px;font-weight:600;cursor:pointer;text-decoration:none}
.btn.light{background:#374151}
.btn:disabled{opacity:.5;cursor:not-allowed}

.list{display:grid;gap:10px}
.item{display:grid;grid-template-columns:1fr 150px 110px 140px;gap:12px;align-items:center;background:#fff;border:1px solid var(--b);border-radius:12px;padding:12px}
@media (max-width:720px){.item{grid-template-columns:1fr 110px 1fr}}

.tabs{display:flex;gap:10px;margin:8px 0 16px}
.tabs a{text-decoration:none;color:var(--t);background:#fff;border:1px solid var(--b);border-radius:999px;padding:8px 12px}

.q{margin:18px 0 8px;font-weight:600}
.opt{display:block;margin:8px 0;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;cursor:pointer;user-select:none}
.opt input{margin-right:8px}
.opt.selected{border-color:#3b82f6;background:#eff6ff}
.explain{background:#f9fafb;border:1px dashed #e5e7eb;border-radius:10px;padding:10px;margin-top:8px}
.result-pass{color:#16a34a;font-weight:700}
.result-fail{color:#dc2626;font-weight:700}
hr.sep{border:none;border-top:1px solid var(--b);margin:14px 0}
/* Header + Logo */
.app-header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--b)}
.app-header .inner{max-width:1200px;margin:0 auto;padding:12px 24px;display:flex;align-items:center}
.logo-container{display:flex;align-items:center;gap:10px;text-decoration:none}
.logo-icon{width:32px;height:32px;border-radius:8px;background:var(--accent);color:#fff;display:grid;place-items:center;font-weight:800;font-size:.95rem;letter-spacing:.5px}
.logo{font-weight:800;color:var(--t);font-size:1rem}
</style>

</head>
<body>
  <!-- å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ­ã‚´ï¼‰ -->
  <header class="app-header">
    <div class="inner">
      <a href="/" class="logo-container" aria-label="AI Creator Agency ãƒ›ãƒ¼ãƒ ">
        <div class="logo-icon">AI</div>
        <div class="logo">Creator Agency</div>
      </a>
    </div>
  </header>
<div class="layout">
  <!-- å·¦ï¼šå—è¬›ç”Ÿã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
  <aside class="sidenav">
    <h3>å—è¬›ç”Ÿãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
    <a href="/student">ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
    <a href="/student/seminars">ğŸ—“ï¸ ã‚»ãƒŸãƒŠãƒ¼äºˆç´„</a>
    <a href="/student/courses">ğŸ“š ãƒã‚¤ã‚³ãƒ¼ã‚¹</a>
    <a href="/student/tests" class="active">ğŸ“ ãƒ†ã‚¹ãƒˆä¸€è¦§</a>
    <a href="/student/payments">ğŸ’³ æ”¯æ‰•ã„å±¥æ­´</a>
  </aside>

  <!-- å³ï¼šãƒ¡ã‚¤ãƒ³ -->
  <main class="container">
    <nav class="tabs">
      <a href="/student">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
      <a href="/student/seminars">ã‚»ãƒŸãƒŠãƒ¼äºˆç´„</a>
      <a href="/student/courses">ãƒã‚¤ã‚³ãƒ¼ã‚¹</a>
      <a href="/student/tests">ãƒ†ã‚¹ãƒˆä¸€è¦§</a>
    </nav>

    <div style="margin:12px 0 16px;">
      <a href="/student" style="text-decoration:none;">â† å­¦ç¿’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸</a>
    </div>

    <!-- =========================
         View A: ãƒ†ã‚¹ãƒˆä¸€è¦§
    ========================== -->
    <section id="view-list">
      <h1 style="font-size:1.4rem;margin:0 0 6px;">S-004 ãƒ†ã‚¹ãƒˆä¸€è¦§</h1>
      <p class="muted" style="margin:0 0 14px;">å„ãƒ†ã‚¹ãƒˆã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨å‰å›ã‚¹ã‚³ã‚¢ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>

      <section class="card">
        <div class="row" style="margin-bottom:12px">
          <strong>å—é¨“å¯èƒ½ãªãƒ†ã‚¹ãƒˆ</strong>
          <span class="muted">è¡¨ç¤º: ã™ã¹ã¦</span>
        </div>
        <div class="list" id="test-list"></div>
      </section>
    </section>

    <!-- =========================
         View B: ãƒ†ã‚¹ãƒˆå—é¨“
    ========================== -->
    <section id="view-take" style="display:none">
      <div class="row">
        <h1 id="take-title" style="font-size:1.4rem;margin:0">ãƒ†ã‚¹ãƒˆå—é¨“</h1>
        <a href="#" class="btn light" id="back-to-list">â† ãƒ†ã‚¹ãƒˆä¸€è¦§ã¸æˆ»ã‚‹</a>
      </div>
      <p class="muted" id="take-meta" style="margin:6px 0 14px;"></p>

      <!-- ãƒ†ã‚¹ãƒˆæœ¬ä½“ -->
      <section class="card" id="exam">
        <div class="row" style="align-items:center;justify-content:space-between;margin-bottom:8px;">
          <div class="grow"><strong id="paper-title">â€”</strong></div>
          <div><span class="badge" id="limit">åˆ¶é™ãªã—</span></div>
        </div>

        <div id="qwrap"></div>

        <div style="margin-top:16px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
          <button id="submit" class="btn">è§£ç­”ã‚’æå‡ºã™ã‚‹</button>
          <span class="muted" id="warn" aria-live="polite"></span>
        </div>
      </section>

      <!-- çµæœ -->
      <section class="card" id="result" style="display:none;margin-top:16px;">
        <h2 style="margin:0 0 8px;">çµæœ</h2>
        <p style="margin:6px 0;">
          <span id="judge" class="result-pass">åˆæ ¼</span> ï½œ å¾—ç‚¹ï¼š<strong id="score">0</strong>ç‚¹ / <span id="full">100</span>ç‚¹
        </p>
        <div id="detail"></div>
        <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap;">
          <button id="retry" class="btn light">ã‚‚ã†ä¸€åº¦å—ã‘ã‚‹</button>
          <a href="#" id="to-list-from-result" class="btn" style="text-decoration:none;">ãƒ†ã‚¹ãƒˆä¸€è¦§ã¸æˆ»ã‚‹</a>
        </div>
      </section>
    </section>
  </main>
</div>

<script>
/** -------------------------------------------
 *  ãƒ†ã‚¹ãƒˆå®šç¾©ï¼ˆä¸€è¦§ + å•é¡Œï¼‰
 *  å¿…è¦ã«å¿œã˜ã¦ã“ã“ã«å¢—ã‚„ã™ã ã‘ã§OK
 * ------------------------------------------- */
const TEST_BANK = {
  "lesson003-test-v1": {
    id: "lesson003-test-v1",
    title: "Lesson 003 ç¢ºèªãƒ†ã‚¹ãƒˆ",
    course: "ã‚µãƒ³ãƒ—ãƒ«åŸºç¤",
    passing: 70,
    questions: [
      {
        id: "q1",
        text: "å‹•ç”»Lesson 003ã®ä¸»é¡Œã¨ã—ã¦æœ€ã‚‚è¿‘ã„ã‚‚ã®ã¯ã©ã‚Œï¼Ÿ",
        options: ["é€²æ—ä¿å­˜ã®ä»•çµ„ã¿", "SNSã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åˆ†æ", "ã‚»ãƒŸãƒŠãƒ¼äºˆç´„å°ç·š", "æ”¯æ‰•ã„ç®¡ç†ã®è‡ªå‹•åŒ–"],
        correct: 0,
        explain: "Lesson 003ã§ã¯è¦–è´ã¨é€²æ—ä¿å­˜ï¼ˆS-003ï¼‰ãŒãƒ†ãƒ¼ãƒã§ã—ãŸã€‚"
      },
      {
        id: "q2",
        text: "é€²æ—%ãŒæ›´æ–°ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨ã—ã¦æ­£ã—ã„ã‚‚ã®ã¯ï¼Ÿ",
        options: ["å†ç”Ÿç›´å¾Œ", "10ã€œ20ç§’å†ç”Ÿå¾Œ", "åœæ­¢ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™å‰", "ãƒšãƒ¼ã‚¸é·ç§»å¾Œã®ã¿"],
        correct: 1,
        explain: "10ã€œ20ç§’å†ç”Ÿå¾Œã«ä¸€åº¦åœæ­¢ã§é€²æ—ä¿å­˜ã‚’æƒ³å®šã—ã¦ã„ã¾ã—ãŸã€‚"
      },
      {
        id: "q3",
        text: "è³‡æ–™ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®æƒ³å®šå ´æ‰€ã¯ã©ã“ï¼Ÿ",
        options: ["ãƒ˜ãƒƒãƒ€ãƒ¼", "ãƒ•ãƒƒã‚¿ãƒ¼", "å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¸‹éƒ¨", "åˆ¥ã‚¿ãƒ–ã®ã¿"],
        correct: 2,
        explain: "S-003è¨­è¨ˆã§ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸‹éƒ¨ã«è³‡æ–™ãƒªãƒ³ã‚¯ã‚’é…ç½®ã€‚"
      }
    ]
  },

  // ä¾‹ï¼šè¿½åŠ ã—ãŸã„å ´åˆã¯ã“ã®å½¢å¼ã§å¢—ã‚„ã—ã¾ã™
  // "courseA-midterm-v1": { id: "...", title: "...", course: "...", passing: 80, questions: [ ... ] }
};

/** -------------------------------------------
 *  DOM å‚ç…§
 * ------------------------------------------- */
const viewList = document.getElementById('view-list');
const viewTake = document.getElementById('view-take');
const backBtn = document.getElementById('back-to-list');
const toListFromResult = document.getElementById('to-list-from-result');

const listWrap = document.getElementById('test-list');

const takeTitle = document.getElementById('take-title');
const takeMeta = document.getElementById('take-meta');
const paperTitle = document.getElementById('paper-title');
const limitBadge = document.getElementById('limit');

const qwrap = document.getElementById('qwrap');
const submitBtn = document.getElementById('submit');
const warn = document.getElementById('warn');
const resultBox = document.getElementById('result');
const examBox = document.getElementById('exam');
const scoreEl = document.getElementById('score');
const judgeEl = document.getElementById('judge');
const retryBtn = document.getElementById('retry');

/** -------------------------------------------
 *  å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 * ------------------------------------------- */
function keyResult(id){ return `test-result:${id}`; }
function saveResult(id, payload){
  localStorage.setItem(keyResult(id), JSON.stringify(payload));
}
function loadResult(id){
  const raw = localStorage.getItem(keyResult(id));
  return raw ? JSON.parse(raw) : null;
}
function clearResult(id){
  localStorage.removeItem(keyResult(id));
}
function grade(questions, answers){
  let score = 0;
  const perQ = Math.floor(100 / questions.length);
  questions.forEach(q=>{
    if(answers[q.id] === q.correct) score += perQ;
  });
  if(score>100) score = 100;
  return score;
}

/** -------------------------------------------
 *  View åˆ‡ã‚Šæ›¿ãˆ
 * ------------------------------------------- */
function showList(){
  viewTake.style.display = 'none';
  viewList.style.display = 'block';
  renderList();
  history.replaceState(null, "", "/student/tests");
}
function showTake(testId){
  const T = TEST_BANK[testId];
  if(!T){ alert("ãƒ†ã‚¹ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"); return; }

  // ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±
  takeTitle.textContent = "S-004 ãƒ†ã‚¹ãƒˆå—é¨“";
  takeMeta.textContent = `ã‚³ãƒ¼ã‚¹ï¼š${T.course} ï½œ åˆæ ¼ãƒ©ã‚¤ãƒ³ï¼š${T.passing}ç‚¹`;
  paperTitle.textContent = `ãƒ†ã‚¹ãƒˆï¼š${T.title}`;
  limitBadge.textContent = "åˆ¶é™ãªã—";

  // å•é¡Œè¡¨ç¤º
  renderQuestions(T);

  // çµæœè¡¨ç¤ºã‚¯ãƒªã‚¢
  resultBox.style.display = 'none';
  examBox.style.display = 'block';

  // éå»å—é¨“ãŒã‚ã‚Œã°çµæœã‚’å…ˆã«è¡¨ç¤ºï¼ˆä»»æ„ï¼‰
  const prev = loadResult(T.id);
  if(prev){ showResult(T, prev); }

  viewList.style.display = 'none';
  viewTake.style.display = 'block';
  history.replaceState(null, "", `/student/test/${encodeURIComponent(testId)}`);
}

/** -------------------------------------------
 *  ãƒ†ã‚¹ãƒˆä¸€è¦§
 * ------------------------------------------- */
function renderList(){
  const items = Object.values(TEST_BANK);
  listWrap.innerHTML = items.map(T=>{
    const prev = loadResult(T.id);
    let badgeCls = 'badge warn';
    let badgeTxt = 'æœªå—é¨“';
    let scoreTxt = 'â€”';
    if(prev){
      scoreTxt = `${prev.score} ç‚¹`;
      if(prev.score >= T.passing){ badgeCls = 'badge'; badgeTxt = 'åˆæ ¼'; }
      else { badgeCls = 'badge danger'; badgeTxt = 'ä¸åˆæ ¼'; }
    }
    return `
      <div class="item">
        <div>
          <div style="font-weight:600">${T.title}</div>
          <div class="muted">ã‚³ãƒ¼ã‚¹ï¼š${T.course}</div>
        </div>
        <div><span class="${badgeCls}">${badgeTxt}</span></div>
        <div class="muted">å‰å›ã‚¹ã‚³ã‚¢ï¼š${scoreTxt}</div>
        <div style="text-align:right">
          <button class="btn" data-take="${T.id}">å—é¨“ã™ã‚‹</button>
        </div>
      </div>
    `;
  }).join('');

  // ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆä»˜ä¸
  listWrap.querySelectorAll('button[data-take]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.getAttribute('data-take');
      showTake(id);
    });
  });

  // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è‡ªå‹•ä»˜ä¸
  (function(){
    var path = location.pathname.replace(/\/+$/,'');
    document.querySelectorAll('.sidenav a').forEach(a=>{
      var href=(a.getAttribute('href')||'').replace(/\/+$/,'');
      if(href && (href===path || (href!=='/' && path.startsWith(href)))) a.classList.add('active');
    });
  })();
}

/** -------------------------------------------
 *  å—é¨“ç”»é¢ï¼šå•é¡Œç”Ÿæˆ
 * ------------------------------------------- */
function renderQuestions(T){
  const Q = T.questions;
  qwrap.innerHTML = Q.map((q, idx)=>`
    <section>
      <div class="q">Q${idx+1}. ${q.text}</div>
      ${q.options.map((opt,i)=>`
        <label class="opt">
          <input type="radio" name="${q.id}" value="${i}" />
          ${opt}
        </label>
      `).join('')}
    </section>
  `).join('');

  // è¦‹ãŸç›®ã®é¸æŠçŠ¶æ…‹
  qwrap.querySelectorAll('input[type="radio"]').forEach(inp=>{
    inp.addEventListener('change', ()=>{
      const name = inp.name;
      qwrap.querySelectorAll(`input[name="${name}"]`).forEach(x=>x.closest('.opt').classList.remove('selected'));
      inp.closest('.opt').classList.add('selected');
    });
  });

  // é€ä¿¡ãƒãƒ³ãƒ‰ãƒ©ã‚’å·®ã—æ›¿ãˆ
  submitBtn.onclick = function(){
    const answers = {};
    let all = true;
    Q.forEach(q=>{
      const sel = qwrap.querySelector(`input[name="${q.id}"]:checked`);
      answers[q.id] = sel ? Number(sel.value) : null;
      if(answers[q.id] === null) all = false;
    });
    if(!all){
      warn.textContent = "æœªå›ç­”ã®è¨­å•ãŒã‚ã‚Šã¾ã™ã€‚ã™ã¹ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚";
      return;
    }
    warn.textContent = "";
    const score = grade(Q, answers);
    const payload = { score, answers, at: Date.now(), passing: T.passing };
    saveResult(T.id, payload);
    showResult(T, payload);
    // ä¸€è¦§å´ã®è¡¨ç¤ºã‚‚æ›´æ–°ã—ãŸã„ã¨ãã¯ã€å¿…è¦ã«å¿œã˜ã¦ renderList() ã‚’å‘¼ã¶
  };

  // ãƒªãƒˆãƒ©ã‚¤ï¼šçµæœã‚¯ãƒªã‚¢
  retryBtn.onclick = function(){
    clearResult(T.id);
    resultBox.style.display = 'none';
    examBox.style.display = 'block';
    renderQuestions(T);
  };
}

/** -------------------------------------------
 *  å—é¨“ç”»é¢ï¼šçµæœè¡¨ç¤º
 * ------------------------------------------- */
function showResult(T, payload){
  const { score, answers } = payload;
  examBox.style.display = 'none';
  resultBox.style.display = 'block';
  scoreEl.textContent = String(score);
  judgeEl.textContent = score >= T.passing ? "åˆæ ¼" : "ä¸åˆæ ¼";
  judgeEl.className = score >= T.passing ? "result-pass" : "result-fail";

  // è©³ç´°
  const html = T.questions.map((q,idx)=>{
    const yours = answers[q.id];
    const ok = (yours === q.correct);
    return `
      <div style="margin:12px 0;">
        <div style="font-weight:600;">Q${idx+1}. ${q.text}</div>
        <div>ã‚ãªãŸã®å›ç­”ï¼š${yours!==null? q.options[yours]:"â€”"} ${ok? "âœ…":"âŒ"}</div>
        <div>æ­£è§£ï¼š${q.options[q.correct]}</div>
        <div class="explain">${q.explain}</div>
      </div>
    `;
  }).join('');
  document.getElementById('detail').innerHTML = html;
}

/** -------------------------------------------
 *  ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆä¸€è¦§ <-> å—é¨“ï¼‰
 *  - /student/tests                     => ä¸€è¦§
 *  - /student/test/<id>                 => è©²å½“ãƒ†ã‚¹ãƒˆå—é¨“
 * ------------------------------------------- */
function route(){
  const path = location.pathname.replace(/\/+$/,'');
  const m = path.match(/^\/student\/test\/(.+)$/);
  if(m){
    const id = decodeURIComponent(m[1]);
    if(TEST_BANK[id]) showTake(id);
    else showList();
  }else{
    showList();
  }
}

// æˆ»ã‚‹ãƒœã‚¿ãƒ³
backBtn.addEventListener('click', (e)=>{ e.preventDefault(); showList(); });
toListFromResult.addEventListener('click', (e)=>{ e.preventDefault(); showList(); });

// åˆæœŸè¡¨ç¤º
route();
</script>
</body>
</html>
